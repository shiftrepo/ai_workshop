# ブリーフィング・ドキュメント：Claude Codeのベストプラクティス

## エグゼクティブサマリー

本ブリーフィングは、AnthropicのAIコーディングアシスタント「Claude Code」の機能、動作原理、ユースケース、およびベストプラクティスに関する包括的な概要を提供する。Claude Codeは、ターミナル上での操作に長けた熟練の同僚のように機能する「ピュアエージェント」として設計されている。その核となるのは、コードベースのインデックス化や埋め込みに頼らず、globやgrepといったコマンドラインツールを用いた「エージェント的探索（Agentic Search）」によって、人間と同様にコードベースを理解する能力である。

主なユースケースは、新規コードベースへのオンボーディングといった「発見」から、実装前の「思考パートナー」、新規および既存プロジェクトでの「コーディング」、CI/CDへの統合といった「デプロイメント」、さらには大規模なコードベース移行の支援まで多岐にわたる。

Claude Codeを最大限に活用するためのベストプラクティスとして、プロジェクト固有の指示やスタイルガイドを記述する`claude.md`ファイルの活用、ワークフローを高速化するための権限管理のカスタマイズ、そして200,000トークンのコンテキストウィンドウを管理するための`/compact`コマンドの使用が挙げられる。特に、新しいモデル（Opusなど）は指示追従能力が向上しており、`claude.md`の効果をさらに高めている。また、ツール呼び出しの合間に思考する機能が追加され、より複雑なタスクへの対応能力が向上している。

---

## 1. Claude Codeの概要と動作原理

### 1.1. Claude Codeとは

Claude Codeは、ターミナル操作に精通したエンジニアのように振る舞うAIコーディングエージェントである。GUIを一切使わず、コマンドライン上であらゆる操作をこなす熟練のメンターが常に隣にいるような体験を提供する。Anthropicでは、これを「ピュアエージェント」と定義している。これは、一連の指示と強力なツール群を与えられ、タスクが完了したと自己判断するまでループで動作するモデルを指す。

### 1.2. 内部の仕組み

Claude Codeは「シンプルに機能するもの」という設計思想に基づいている。

#### エージェント的探索 (Agentic Search)

従来のAIコーディングツールとは異なり、Claude Codeはコードベース全体のインデックス作成やRAG（Retrieval-Augmented Generation）といった手法を用いない。代わりに、開発者が新しいコードベースを探索するのと同じ方法で、glob、grep、findなどの検索ツールを駆使してコードベースを理解する。この「エージェント的探索」により、モデルは検索を実行し、その結果を分析し、さらに必要な情報を得るために追加の検索を行うという反復的なプロセスを通じて、プロジェクトの構造や内容を把握する。

#### アーキテクチャ

- **コアエージェント**: ファイルの作成・編集、ターミナルコマンドの実行、MCP（Model-Controllable Peripherals）による外部ツール連携など、強力なツール群を備えている。
- **UIレイヤー**: エージェントの動作をリアルタイムで表示する、軽量なUIを提供する。
- **権限システム**: エージェントが危険な操作（ファイルの変更やコマンド実行など）を行う際に、ユーザーの介入を求めることで安全性を確保する。
- **セキュリティ**: AnthropicのAPIだけでなく、AWSやGCPといったクラウドプロバイダー経由でも利用可能であり、セキュリティ要件に応じてClaudeの利用方法を柔軟に選択できる。

---

## 2. 主なユースケース

Claude Codeは、ソフトウェア開発ライフサイクルのあらゆる段階で価値を提供する。

| カテゴリ | 具体的なユースケース |
|---------|---------------------|
| **発見 (Discovery)** | 新しいチームやオープンソースプロジェクトに参加した際のコードベースの探索、特定機能の実装箇所の特定、Git履歴の分析によるコードの変遷の把握。 |
| **思考パートナー (Thought Partnership)** | コーディングに着手する前に、機能実装の計画を立てさせる。複数の実装アプローチを調査・提案させ、最適な方針を共同で決定する。 |
| **ビルドとコーディング (Building & Coding)** | 空のディレクトリから新しいアプリやゲームを構築する「ゼロからイチ」のプロジェクト。より重要なのは、既存のコードベース内での作業であり、特にユニットテストの追加や、コミットメッセージ・プルリクエストメッセージの自動生成において高い生産性を発揮する。 |
| **デプロイメントとライフサイクル (Deployment & Lifecycle)** | Claude Code SDKを利用したヘッドレス（UIなし）でのプログラム実行。CI/CDパイプラインへの組み込みや、GitHub Actionsでの自動化など。 |
| **サポートとスケーリング (Support & Scale)** | エラーの迅速なデバッグ支援。大規模なコードベースの移行（例：旧Javaバージョンから新バージョンへ、PHPからReact/Angularへ）といった、従来は多大な工数がかかっていたプロジェクトの実行を容易にする。 |
| **CLIツールの活用** | Git、Docker、BigQueryなど、あらゆるCLIツールを巧みに使いこなす。複雑なgit rebaseの修正なども対話的に解決できる。 |

---

## 3. ベストプラクティス

### 3.1. ファイルの効果的な活用

`claude.md`は、セッションをまたいで状態を共有するための主要なメカニズムであり、エージェントの「記憶」として機能する。Claude Code起動時に作業ディレクトリ内の`claude.md`が自動的に読み込まれ、プロンプトのコンテキストに追加される。

#### 記述内容の例

- ユニットテストの実行方法
- プロジェクトのディレクトリ構造の概要
- コーディングスタイルガイド
- 内部で使用されているCLIツールの説明

#### 配置場所

- **プロジェクトルート**: チームメンバー間で共通の指示を共有する。
- **ホームディレクトリ**: 作業中のプロジェクトに関わらず、常にClaudeに認識させたい個人的な設定や指示を記述する。

### 3.2. 権限管理

セキュリティと効率のバランスを取るため、権限管理のカスタマイズが重要である。

- **デフォルト設定**: 読み取り操作（検索やファイル閲覧）は自動で許可されるが、書き込みやコマンド実行などの変更を伴う操作はユーザーの確認を求める。
- **高速化のための設定**:
  - **オートアクセプトモード (Shift + Tab)**: 全ての操作を自動で許可し、ワークフローを高速化する。
  - **特定コマンドの常時承認**: `npm run test`のように頻繁に実行する安全なコマンドを、設定ファイルで常に許可するように指定できる。

### 3.3. 統合セットアップ

Claude Codeはターミナル操作に非常に長けているため、これを活用することが生産性向上の鍵となる。

- **CLIツールの活用**: GitHubの`gh`コマンドのような、ドキュメントが整備された有名なCLIツールをインストールすることを推奨する。これにより、Claude Codeが実行できる作業の幅が広がる。
- **内部ツールの連携**: 組織独自の内部ツールがある場合、その使用方法を`claude.md`に記述することで、Claudeにそのツールを使わせることができる。

### 3.4. コンテキスト管理

Claude Codeは最大200,000トークンのコンテキストウィンドウを持つが、長時間のセッションでは上限に達することがある。

- **`/clear`**: コンテキストを完全にリセットする（`claude.md`の内容は保持される）。
- **`/compact`**: これまでの対話履歴をClaude自身に要約させ、その要約を新しいセッションの開始点とすることで、文脈を維持したままコンテキストを圧縮する。

### 3.5. 効率的なワークフロー

#### 計画とToDoリスト

「このバグを修正して」と直接指示するのではなく、「このバグの原因を調査し、修正計画を立てて」と依頼する。Claudeが生成した計画やToDoリストを確認し、逸脱が見られた場合は早期に修正できる。

#### スマートなコーディング手法

テスト駆動開発（TDD）を実践させ、小さな変更ごとにテストとリンターを実行させる。こまめにコミットすることで、問題が発生した際に容易にロールバックできる。

#### スクリーンショットの活用

Claudeはマルチモーダルモデルであるため、UIのスクリーンショットやデザインモックの画像を貼り付けて、「この画像に基づいてウェブサイトを構築して」といった指示が可能。

---

## 4. 高度なテクニック

### 複数Claudeの同時実行

複数のターミナル（タブやtmuxセッション）でClaude Codeを同時に実行し、それぞれに異なるタスクを割り当てることで、複雑な作業を並行して進めることができる。エージェント間の連携は、共有のマークダウンファイルへの書き込み・読み込みを指示することで実現できる。

### Escapeキーの活用

Claudeの作業中にEscapeキーを押すことで、処理を中断して指示を修正したり、異なるアプローチを提案したりできる。Escapeを2回押すと、対話履歴を遡って特定の時点からやり直すという隠し機能も存在する。

### MCPによるツール拡張

標準のツールセットで不足する場合、MCP（Model-Controllable Peripherals）サーバーを構築して機能を拡張できる。

### ヘッドレス自動化

Claude Code SDKを用いて、GitHub Actionsやその他の自動化パイプラインにClaudeのコーディング能力をプログラム的に組み込む。

---

## 5. 最新機能と注目点

### モデル選択と思考機能の強化

- **`/model`コマンド**: SonnetやOpusといった利用モデルを切り替え可能になった。
- **思考機能**: 最新モデルでは、ツールを呼び出す合間に「思考」する（think hard）機能が追加された。これにより、一連のツール呼び出し全体がより計画的かつ効果的になる。

### IDE統合

VS CodeおよびJetBrains向けの新しい拡張機能が提供されている。

### claude.mdの改善された解釈

Claude 4（Opusなど）のモデルは、旧モデルに比べて`claude.md`内の指示に格段に従順になった。これにより、以前は無視されがちだった細かい指示（例：「インラインコメントを追加しないで」）も遵守されるようになった。

### 変更履歴の追跡

開発は非常に速いペースで進んでいるため、Anthropicの公開GitHubプロジェクトにある変更履歴を定期的に確認することが推奨される。